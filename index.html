<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="basestyle.css">
</head>
<body>
<div class=tableft>
<h2>Avec form, input et textarea</h2>
<form id="form" onSubmit="valider(); return false;">
<label>Nom Prénom : </label><input type="text" id="name" name="Nom Prénom" value="Ajouter"></br>
<label>Adresse :  </label><textarea id="address" name="Adresse" rows=4 onchange="osmdiv(this)">Ajouter</textarea></br>
<input type="submit" value="Valider" class="valid">
<p>Rentrez votre adresse et appuyez sur [Tab]</p>
</form>
</div>
<div class=tableft>
<div class=box>
<label>Longitude OSM</label> <div id="longdivosm">long OSM</div>
<label>Latitude OSM</label> <div id="latdivosm">lat OSM</div><br/>
<label>Longitude GMAP</label> <div id="longdivgmap">Long GMAP</div>
<label>Latitude GMAP</label> <div id="latdivgmap">Lat GMAP</div><br/>
<p id="contenu" ></p>
</div>
<iframe class=box id="carte" src="http://www.openstreetmap.org/export/embed.html?bbox=0.33856,46.58097,0.34742,46.58438&amp;layer=mapquest&amp;marker=46.58143,0.33957"></iframe><br />
<div class=box><a href="http://www.openstreetmap.org/?lat=46.582675&amp;lon=0.34299&amp;zoom=16&amp;layers=Q&amp;mlat=46.58143&amp;mlon=0.33957">Voir une carte plus grande</a></div>
</div>
<div class=tableft>
<h2>En div contenteditable et oninput</h2>
<label>Nom Prenom </label> <div id="namediv" contenteditable="true">Ajouter </div><br/>
<label>Adresse </label> <div id="addressdiv" contenteditable="true" oninput="osmdiv(this)">Ajouter </div><br/>
<div id="validerdiv" class="valid" onclick="valider()">Valider</div><br/>
<p>Rentrez votre adresse et appuyez sur [Tab]</p>
</div>
<div id="demoMap" style="height:250px"></div>
<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="ol.js"></script>
<script>
      
function valider() {
	document.getElementById("contenu").innerHTML=" Contenu Validé ";
}
function osmdiv(element) {
	if (element.tag == "DIV") {
		source = element.innerHTML;
	} else if (element.tag == "TEXTAREA") {
		source = element.value;
	} else {
		source = element.value;
	}
	var xmlhttp = new XMLHttpRequest();
	var urlosm = "http://nominatim.openstreetmap.org/search?email=jerome.avond@alolise.org&format=json&q=" + source ;
	var urlgmp = "https://maps.googleapis.com/maps/api/geocode/json?address=" + source + "&key=AIzaSyBV0jQvMpkmQ2QINkntL7liDvooxYt-WfQ";

$.getJSON(urlgmp, function(data) {
	//document.getElementById("contenu").innerHTML=data.results[0].formatted_address;
	glat=data.results[0].geometry.location.lat;
	glong=data.results[0].geometry.location.lng;
	document.getElementById("latdivgmap").innerHTML=glat;
	document.getElementById("longdivgmap").innerHTML=glong;
	traitement(glat,glong);
});
	

$.getJSON(urlosm, function(data) {
	olat=data[0].lat;
	olon=data[0].lon;
	bolon1=olon-0.005;
	bolat1=olat-0.005;
	bolon2=olon+0.005;
	bolat2=olat+0.005;
	
	document.getElementById("latdivosm").innerHTML=olat;
	document.getElementById("longdivosm").innerHTML=olon;
	maposm="http://www.openstreetmap.org/export/embed.html?bbox="+bolon1+","+bolat1+","+bolon2+","+bolat2+"&amp;layer=mapquest&amp;marker="+olat+","+olon;
	document.getElementById("carte").src=maposm;
	document.getElementById("contenu").innerHTML=maposm;
	document.getElementById("contenu").innerHTML=maposm;

    map = new OpenLayers.Map("demoMap");
    map.addLayer(new OpenLayers.Layer.OSM());
    map.zoomToMaxExtent();

});

}

</script>
</body>
</html>
